<svg xmlns="http://www.w3.org/2000/svg" width="1842" height="1238">
<defs><marker id="arrow-filled" refX="6" refY="3" markerWidth="6" markerHeight="6" orient="auto"><path d="M0,0 6,3 0,6z" style="stroke: none; fill: black;"></path></marker><marker id="arrow-open" refX="6" refY="3" markerWidth="6" markerHeight="6" orient="auto"><path d="M0,0 6,3 0,6" style="stroke-width: 1; fill: none; stroke: black;"></path></marker></defs><rect width="45.5" height="38" style="stroke-width: 1; fill: none; stroke: black;" x="10" y="20"></rect><g><text fill="black" font-family="Helvetica,sans-Serif" x="32.75" y="39" style="text-anchor: middle; alignment-baseline: central;">App</text></g><rect width="45.5" height="38" style="stroke-width: 1; fill: none; stroke: black;" x="10" y="1180"></rect><g><text fill="black" font-family="Helvetica,sans-Serif" x="32.75" y="1199" style="text-anchor: middle; alignment-baseline: central;">App</text></g><path d="M32.75,58 v1122" style="stroke-width: 1; fill: none; stroke: black;"></path><rect width="139" height="38" style="stroke-width: 1; fill: none; stroke: black;" x="351.75" y="20"></rect><g><text fill="black" font-family="Helvetica,sans-Serif" x="421.25" y="39" style="text-anchor: middle; alignment-baseline: central;">MessageService</text></g><rect width="139" height="38" style="stroke-width: 1; fill: none; stroke: black;" x="351.75" y="1180"></rect><g><text fill="black" font-family="Helvetica,sans-Serif" x="421.25" y="1199" style="text-anchor: middle; alignment-baseline: central;">MessageService</text></g><path d="M421.25,58 v1122" style="stroke-width: 1; fill: none; stroke: black;"></path><rect width="105" height="38" style="stroke-width: 1; fill: none; stroke: black;" x="757.25" y="20"></rect><g><text fill="black" font-family="Helvetica,sans-Serif" x="809.75" y="39" style="text-anchor: middle; alignment-baseline: central;">NodeEvents</text></g><rect width="105" height="38" style="stroke-width: 1; fill: none; stroke: black;" x="757.25" y="1180"></rect><g><text fill="black" font-family="Helvetica,sans-Serif" x="809.75" y="1199" style="text-anchor: middle; alignment-baseline: central;">NodeEvents</text></g><path d="M809.75,58 v1122" style="stroke-width: 1; fill: none; stroke: black;"></path><rect width="122" height="38" style="stroke-width: 1; fill: none; stroke: black;" x="967.25" y="20"></rect><g><text fill="black" font-family="Helvetica,sans-Serif" x="1028.25" y="39" style="text-anchor: middle; alignment-baseline: central;">Venus-Sealer</text></g><rect width="122" height="38" style="stroke-width: 1; fill: none; stroke: black;" x="967.25" y="1180"></rect><g><text fill="black" font-family="Helvetica,sans-Serif" x="1028.25" y="1199" style="text-anchor: middle; alignment-baseline: central;">Venus-Sealer</text></g><path d="M1028.25,58 v1122" style="stroke-width: 1; fill: none; stroke: black;"></path><rect width="79.5" height="38" style="stroke-width: 1; fill: none; stroke: black;" x="1109.25" y="20"></rect><g><text fill="black" font-family="Helvetica,sans-Serif" x="1149" y="39" style="text-anchor: middle; alignment-baseline: central;">gateway</text></g><rect width="79.5" height="38" style="stroke-width: 1; fill: none; stroke: black;" x="1109.25" y="1180"></rect><g><text fill="black" font-family="Helvetica,sans-Serif" x="1149" y="1199" style="text-anchor: middle; alignment-baseline: central;">gateway</text></g><path d="M1149,58 v1122" style="stroke-width: 1; fill: none; stroke: black;"></path><rect width="122" height="38" style="stroke-width: 1; fill: none; stroke: black;" x="1208.75" y="20"></rect><g><text fill="black" font-family="Helvetica,sans-Serif" x="1269.75" y="39" style="text-anchor: middle; alignment-baseline: central;">WalletClient</text></g><rect width="122" height="38" style="stroke-width: 1; fill: none; stroke: black;" x="1208.75" y="1180"></rect><g><text fill="black" font-family="Helvetica,sans-Serif" x="1269.75" y="1199" style="text-anchor: middle; alignment-baseline: central;">WalletClient</text></g><path d="M1269.75,58 v1122" style="stroke-width: 1; fill: none; stroke: black;"></path><rect width="122" height="38" style="stroke-width: 1; fill: none; stroke: black;" x="1350.75" y="20"></rect><g><text fill="black" font-family="Helvetica,sans-Serif" x="1411.75" y="39" style="text-anchor: middle; alignment-baseline: central;">MessageState</text></g><rect width="122" height="38" style="stroke-width: 1; fill: none; stroke: black;" x="1350.75" y="1180"></rect><g><text fill="black" font-family="Helvetica,sans-Serif" x="1411.75" y="1199" style="text-anchor: middle; alignment-baseline: central;">MessageState</text></g><path d="M1411.75,58 v1122" style="stroke-width: 1; fill: none; stroke: black;"></path><rect width="147.5" height="38" style="stroke-width: 1; fill: none; stroke: black;" x="1492.75" y="20"></rect><g><text fill="black" font-family="Helvetica,sans-Serif" x="1566.5" y="39" style="text-anchor: middle; alignment-baseline: central;">MessageSelector</text></g><rect width="147.5" height="38" style="stroke-width: 1; fill: none; stroke: black;" x="1492.75" y="1180"></rect><g><text fill="black" font-family="Helvetica,sans-Serif" x="1566.5" y="1199" style="text-anchor: middle; alignment-baseline: central;">MessageSelector</text></g><path d="M1566.5,58 v1122" style="stroke-width: 1; fill: none; stroke: black;"></path><rect width="122" height="38" style="stroke-width: 1; fill: none; stroke: black;" x="1690" y="20"></rect><g><text fill="black" font-family="Helvetica,sans-Serif" x="1751" y="39" style="text-anchor: middle; alignment-baseline: central;">walletClient</text></g><rect width="122" height="38" style="stroke-width: 1; fill: none; stroke: black;" x="1690" y="1180"></rect><g><text fill="black" font-family="Helvetica,sans-Serif" x="1751" y="1199" style="text-anchor: middle; alignment-baseline: central;">walletClient</text></g><path d="M1751,58 v1122" style="stroke-width: 1; fill: none; stroke: black;"></path><g><text fill="black" font-family="Helvetica,sans-Serif" x="138.5" y="87" style="text-anchor: middle; alignment-baseline: central;">cfg.JWT=genSecret()</text></g><path d="M32.75,73 C72.75,73 72.75,106 32.75,106" style="stroke-width: 1; fill: none; stroke: black;" marker-end="url(#arrow-filled)"></path><g><text fill="black" font-family="Helvetica,sans-Serif" x="202.25" y="125" style="text-anchor: middle; alignment-baseline: central;">fx.Invoke(service.StartNodeEvents)</text></g><path d="M32.75,111 C72.75,111 72.75,144 32.75,144" style="stroke-width: 1; fill: none; stroke: black;" marker-end="url(#arrow-filled)"></path><g><text fill="black" font-family="Helvetica,sans-Serif" x="227" y="159" style="text-anchor: middle; alignment-baseline: central;">StartPushMessage</text></g><path d="M32.75,172 h388.5" style="stroke-width: 1; fill: none; stroke: black;" marker-end="url(#arrow-filled)"></path><g><text fill="black" font-family="Helvetica,sans-Serif" x="421.25" y="197" style="text-anchor: middle; alignment-baseline: central;">listenHeadChangesOnce</text></g><path d="M32.75,210 h777" style="stroke-width: 1; fill: none; stroke: black;" marker-end="url(#arrow-filled)"></path><g><text fill="black" font-family="Helvetica,sans-Serif" x="421.25" y="235" style="text-anchor: middle; alignment-baseline: central;">start</text></g><path d="M32.75,248 h777" style="stroke-width: 1; fill: none; stroke: black;" marker-end="url(#arrow-filled)"></path><g><text fill="black" font-family="Helvetica,sans-Serif" x="924" y="277" style="text-anchor: middle; alignment-baseline: central;">listenHeadChangesOnce</text></g><path d="M809.75,263 C849.75,263 849.75,296 809.75,296" style="stroke-width: 1; fill: none; stroke: black;" marker-end="url(#arrow-filled)"></path><g><text fill="black" font-family="Helvetica,sans-Serif" x="189.5" y="315" style="text-anchor: middle; alignment-baseline: central;">fx.Invoke(fx.Invoke(api.RunAPI)</text></g><path d="M32.75,301 C72.75,301 72.75,334 32.75,334" style="stroke-width: 1; fill: none; stroke: black;" marker-end="url(#arrow-filled)"></path><g><text fill="black" font-family="Helvetica,sans-Serif" x="232" y="353" style="text-anchor: middle; alignment-baseline: central;">gatewayProvider=gateway.NewWalletClient()</text></g><path d="M32.75,339 C72.75,339 72.75,372 32.75,372" style="stroke-width: 1; fill: none; stroke: black;" marker-end="url(#arrow-filled)"></path><g><text fill="black" font-family="Helvetica,sans-Serif" x="724.75" y="387" style="text-anchor: middle; alignment-baseline: central;">PushMessage</text></g><path d="M1028.25,400 h-607" style="stroke-width: 1; fill: none; stroke: black;" marker-end="url(#arrow-filled)"></path><g><text fill="black" font-family="Helvetica,sans-Serif" x="493" y="429" style="text-anchor: middle; alignment-baseline: central;">pushMessage</text></g><path d="M421.25,415 C461.25,415 461.25,448 421.25,448" style="stroke-width: 1; fill: none; stroke: black;" marker-end="url(#arrow-filled)"></path><g><text fill="black" font-family="Helvetica,sans-Serif" x="590.875" y="463" style="text-anchor: middle; alignment-baseline: central;">NewGatewayService</text></g><path d="M32.75,476 h1116.25" style="stroke-width: 1; fill: none; stroke: black;" marker-end="url(#arrow-filled)"></path><g><text fill="black" font-family="Helvetica,sans-Serif" x="590.875" y="501" style="text-anchor: middle; alignment-baseline: central;">gatewayService</text></g><path d="M1149,514 h-1116.25" style="stroke-width: 1; fill: none; stroke: black;" stroke-dasharray="7,4" marker-end="url(#arrow-filled)"></path><g><text fill="black" font-family="Helvetica,sans-Serif" x="155.5" y="543" style="text-anchor: middle; alignment-baseline: central;">fx.Supply(walletClient)</text></g><path d="M32.75,529 C72.75,529 72.75,562 32.75,562" style="stroke-width: 1; fill: none; stroke: black;" marker-end="url(#arrow-filled)"></path><g><text fill="black" font-family="Helvetica,sans-Serif" x="845.5" y="577" style="text-anchor: middle; alignment-baseline: central;">WalletHas</text></g><path d="M421.25,590 h848.5" style="stroke-width: 1; fill: none; stroke: black;" marker-end="url(#arrow-filled)"></path><g><text fill="black" font-family="Helvetica,sans-Serif" x="845.5" y="615" style="text-anchor: middle; alignment-baseline: central;">has</text></g><path d="M1269.75,628 h-848.5" style="stroke-width: 1; fill: none; stroke: black;" stroke-dasharray="7,4" marker-end="url(#arrow-filled)"></path><g><text fill="black" font-family="Helvetica,sans-Serif" x="916.5" y="653" style="text-anchor: middle; alignment-baseline: central;">SetMessage</text></g><path d="M421.25,666 h990.5" style="stroke-width: 1; fill: none; stroke: black;" marker-end="url(#arrow-filled)"></path><g><text fill="black" font-family="Helvetica,sans-Serif" x="724.75" y="691" style="text-anchor: middle; alignment-baseline: central;">Result</text></g><path d="M421.25,704 h607" style="stroke-width: 1; fill: none; stroke: black;" stroke-dasharray="7,4" marker-end="url(#arrow-filled)"></path><g><text fill="black" font-family="Helvetica,sans-Serif" x="615.5" y="729" style="text-anchor: middle; alignment-baseline: central;">ProcessNewHead</text></g><path d="M809.75,742 h-388.5" style="stroke-width: 1; fill: none; stroke: black;" marker-end="url(#arrow-filled)"></path><g><text fill="black" font-family="Helvetica,sans-Serif" x="620.5" y="771" style="text-anchor: middle; alignment-baseline: central;">ProcessNewHead(ms.headChans &lt;- &amp;headChan)</text></g><path d="M421.25,757 C461.25,757 461.25,790 421.25,790" style="stroke-width: 1; fill: none; stroke: black;" marker-end="url(#arrow-filled)"></path><g><text fill="black" font-family="Helvetica,sans-Serif" x="527" y="809" style="text-anchor: middle; alignment-baseline: central;">refreshMessageState</text></g><path d="M421.25,795 C461.25,795 461.25,828 421.25,828" style="stroke-width: 1; fill: none; stroke: black;" marker-end="url(#arrow-filled)"></path><g><text fill="black" font-family="Helvetica,sans-Serif" x="535.5" y="847" style="text-anchor: middle; alignment-baseline: central;">doRefreshMessageState</text></g><path d="M421.25,833 C461.25,833 461.25,866 421.25,866" style="stroke-width: 1; fill: none; stroke: black;" marker-end="url(#arrow-filled)"></path><g><text fill="black" font-family="Helvetica,sans-Serif" x="497.25" y="885" style="text-anchor: middle; alignment-baseline: central;">delayTrigger</text></g><path d="M421.25,871 C461.25,871 461.25,904 421.25,904" style="stroke-width: 1; fill: none; stroke: black;" marker-end="url(#arrow-filled)"></path><g><text fill="black" font-family="Helvetica,sans-Serif" x="518.5" y="923" style="text-anchor: middle; alignment-baseline: central;">pushMessageToPool</text></g><path d="M421.25,909 C461.25,909 461.25,942 421.25,942" style="stroke-width: 1; fill: none; stroke: black;" marker-end="url(#arrow-filled)"></path><g><text fill="black" font-family="Helvetica,sans-Serif" x="993.875" y="957" style="text-anchor: middle; alignment-baseline: central;">SelectMessage</text></g><path d="M421.25,970 h1145.25" style="stroke-width: 1; fill: none; stroke: black;" marker-end="url(#arrow-filled)"></path><g><text fill="black" font-family="Helvetica,sans-Serif" x="1663.75" y="999" style="text-anchor: middle; alignment-baseline: central;">selectAddrMessage</text></g><path d="M1566.5,985 C1606.5,985 1606.5,1018 1566.5,1018" style="stroke-width: 1; fill: none; stroke: black;" marker-end="url(#arrow-filled)"></path><g><text fill="black" font-family="Helvetica,sans-Serif" x="1658.75" y="1033" style="text-anchor: middle; alignment-baseline: central;">WalletSign</text></g><path d="M1566.5,1046 h184.5" style="stroke-width: 1; fill: none; stroke: black;" marker-end="url(#arrow-filled)"></path><g><text fill="black" font-family="Helvetica,sans-Serif" x="1658.75" y="1071" style="text-anchor: middle; alignment-baseline: central;">sigI</text></g><path d="M1751,1084 h-184.5" style="stroke-width: 1; fill: none; stroke: black;" stroke-dasharray="7,4" marker-end="url(#arrow-filled)"></path><g><text fill="black" font-family="Helvetica,sans-Serif" x="1655.25" y="1113" style="text-anchor: middle; alignment-baseline: central;">MsgSelectResult</text></g><path d="M1566.5,1099 C1606.5,1099 1606.5,1132 1566.5,1132" style="stroke-width: 1; fill: none; stroke: black;" stroke-dasharray="7,4" marker-end="url(#arrow-filled)"></path><g><text fill="black" font-family="Helvetica,sans-Serif" x="993.875" y="1147" style="text-anchor: middle; alignment-baseline: central;">MsgSelectResult</text></g><path d="M1566.5,1160 h-1145.25" style="stroke-width: 1; fill: none; stroke: black;" stroke-dasharray="7,4" marker-end="url(#arrow-filled)"></path></svg>